Dzinza Backend CapabilitiesThis document outlines the current capabilities of the Dzinza Family Tree Flask backend API.Assumptions:Data persistence relies on local, encrypted JSON files (users.json, family_tree.json). Scalability and concurrency for large datasets or high user counts may be limited.Email functionality (for password reset) requires proper configuration of environment variables (EMAIL_USER, EMAIL_PASSWORD, EMAIL_SERVER, etc.).The frontend application is responsible for all UI rendering and interacts with the backend solely via the documented API endpoints.1. Authentication & Session ManagementUser Registration: Allows new users to register with a username and password. Defaults to a 'basic' role. Handles duplicate username checks.User Login: Authenticates users based on username and password (hashed using bcrypt). Establishes a server-side session upon successful login.User Logout: Clears the user's session on the server.Session Check: Provides an endpoint (/api/session) to check if a user is currently authenticated and retrieve basic user information (ID, username, role).Password Hashing: Uses bcrypt for secure password storage.Session Security: Configured to use secure, HttpOnly session cookies with SameSite=Lax.2. Password ResetRequest Reset: Initiates the password reset flow for a given username (acting as email). Generates a time-sensitive, cryptographically signed token.Email Notification: Sends an email (if configured) to the user containing a unique password reset link.Token Validation: Validates the reset token for correctness and expiry.Password Update: Allows users to set a new password using a valid reset token.3. User Management (Admin)Role-Based Access Control: Distinguishes between 'basic' and 'admin' user roles. Admin-specific endpoints are protected.List Users: Admins can retrieve a list of all registered users (excluding sensitive data like password hashes).Delete User: Admins can delete any user account (except their own).Change User Role: Admins can change the role of any user between 'basic' and 'admin'.4. Person Management (CRUD)Add Person: Allows authenticated users to add new individuals to the family tree with details like names, dates (birth/death), places (birth/death), gender, notes, and custom attributes. Performs basic validation (required fields, date logic).View Person: Allows authenticated users to retrieve details for a specific person by their ID.View All People: Allows authenticated users to retrieve a list of all people in the tree.Edit Person: Allows authenticated users to update the details of an existing person. Performs validation on updated data.Delete Person: Allows authenticated users to delete a person. Automatically removes any relationships associated with that person.5. Relationship Management (CRUD)Add Relationship: Allows authenticated users to create relationships between two existing people, specifying the relationship type (e.g., 'spouse', 'parent', 'child', 'sibling') and optional custom attributes. Performs validation (persons exist, not self-relationship, required fields).View All Relationships: Allows authenticated users to retrieve a list of all relationships.Edit Relationship: Allows authenticated users to modify an existing relationship's type, attributes, or even the people involved. Performs validation on updated data.Delete Relationship: Allows authenticated users to delete a specific relationship by its ID.6. Family Tree Data RetrievalTree Data for Visualization: Provides an endpoint (/api/tree_data) that formats person and relationship data into a structure suitable for graph visualization libraries (like React Flow), containing lists of 'nodes' and 'links'. (Note: Current implementation returns the full tree; planned support for partial loading via query parameters is not fully implemented).7. Data Handling & PersistenceJSON Storage: Persists user data and family tree data (people, relationships) in local JSON files.Encryption: Encrypts the content of users.json and family_tree.json at rest using AES-GCM. The encryption key is loaded from encryption_key.json or generated automatically if not found.Data Loading/Saving: Uses utility functions (db_utils.py) to handle loading, saving, encryption, and decryption of data files. Includes basic error handling for file operations and JSON parsing/decryption.8. LoggingApplication Logging: Records general application events, warnings, and errors to a rotating file (app.log). Includes console logging based on FLASK_DEBUG setting.Audit Logging: Records significant user and system actions (logins, registrations, data modifications, deletions, errors) with timestamps and actor information to a separate file (audit.log).9. API InfrastructureFlask Framework: Built using the Flask microframework.RESTful Endpoints: Provides API endpoints following REST principles for managing resources (users, people, relationships).CORS: Configured to allow cross-origin requests from the specified frontend development server URL(s).Error Handling: Implements custom error handlers for standard HTTP error codes (400, 401, 403, 404, 500, 503) to return consistent JSON error responses.10. Missing Capabilities / Future EnhancementsBased on the current implementation, the following capabilities are not present in the backend:Advanced Search/Filtering: No dedicated API endpoint for searching/filtering people or relationships based on criteria beyond basic ID lookup (e.g., date ranges, locations, attributes).Media Management: No functionality to upload, store, manage, or retrieve photos or documents associated with individuals.GEDCOM Support: No capability to import or export family tree data using the standard GEDCOM format.User Self-Service Profile Updates: No API endpoints for logged-in users to change their own password or update their username/email (if allowed).Collaboration/Sharing: No features for multiple users to work on the same tree simultaneously or share trees with specific permissions. User roles are currently system-wide.Advanced Data Validation: Lacks checks for more complex logical inconsistencies within the family tree data (e.g., preventing cyclical relationships, validating dates across generations).Duplicate Person Detection/Merging: No features to identify potentially duplicate person entries or merge them.Detailed Event Management: No specific system for tracking various life events beyond birth/death dates (e.g., marriage, divorce, migration) with associated details.Partial Tree Loading (API Implementation): The /api/tree_data endpoint currently returns the full tree; the planned capability to load partial data based on start_node and depth is not yet implemented.API Management: Features like rate limiting or API versioning are not implemented.